<!DOCTYPE html>
<html>
<head>
<include file="Public:head"/>
</head>
<body>
<div class="l-container">
  <div class="l-b-row">
    <ul class="wgt-rainbow" >
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
    </ul>
  </div>
  <div class="l-b-row ta-c">
    <div class="l-b-col l-side">
      <div class="box-shadow">
        <h1 class="wgt-logo"> <a href="__APP__/">最虾米-发现前端价值</a> </h1>
      </div> 
    </div>
    <div class="l-b-col l-main">
      <div class="l-inner">
        <div class="l-header" >
          <div class="wgt-breadcrumb"> <a href="__APP__/">首页</a>/<span>热度排行榜</span> </div>
          <nav class="wgt-topNav">
            <include file="Public:top_login"/>
          </nav>
        </div>
        <div class="l-b-row row-fluid">
          <div class="wgt-zpList-summary box-shadow">
            <h2 class="page-title" >热度排行榜</h2>
            <ul class="media-list">
            
             <foreach name="works" item="val">
              <li class="media">
                <em class="rank">{$key+1}</em>
                <if condition="$val['img'] neq ''">
                <a class="pull-left pic" href="__APP__/works/{$val['id']}"> <img class="media-object" src="{$val['img']}" alt=""> </a>
                </if>
                <div class="media-body">
                  <h4 class="media-heading"><a href="__APP__/works/{$val['id']}">{$val['name']}</a></h4>
                  <div class="info">
                  <span class="wgt-star star-{$val['star']}" id="do_rank_class_{$val['id']}" >                    
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'5')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'10')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'15')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'20')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'25')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'30')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'35')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'40')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'45')"></a>
                      <a href="javascript:void(0)" onclick="do_rank({$val['id']},'50')"></a>                                     
                  </span>(<span id="do_rank_{$val['id']}">{$val['rank']}</span>星)<span class="division" >|</span><a href="__APP__/author/{$val['author_id']}">{$val['author']}</a><span class="division" >|</span>来自<a href="__APP__/works/{$val['id']}">{$val['qunname']}</a> 
                  </div>
                  <blockquote> {$val['description']|strip_tags|msubstr=0,300,'utf-8',false} </blockquote>
                  <p class="opts" ><span><a href="javascript:void(0)" onclick="do_good_await('Works','good',{$val['id']})">赞(<span id="do_good_{$val['id']}">{$val['good']}</span>)</a><a href="#">评论(3)</a></span><a href="__APP__/works/{$val['id']}">进入详细>></a></p>                  
                </div>
              </li>
              </foreach>
            </ul>
          </div>          
        </div>
      </div>
    </div>
  </div>
</div>
<include file="Public:footer"/>
<script language="javascript">
//赞/期待 by wewe
function do_good_await(module,mtype,mid){
	if(module!='' && mtype!='' && mid!='')
	{
		$.ajax({
			type: "POST",
			url: "<?php echo __APP__;?>/works/user_action",
			data: "module="+module+"&mtype="+mtype+"&mid="+mid,
			dataType: "json",
			success: function(data){
				if(data.code=='ok'){
					if(mtype=='good'){
						$("#do_good_"+mid).html(data.msg);
					}
					else if(mtype=='await'){
						$("#do_await_"+mid).html(data.msg);
					}
				}
				else if(data.code=='error'){
					alert(data.msg);
				}
			}
		});
	}
}
//评星 by wewe
function do_rank(mid,score){
	if(score!='' && score!='')
	{
		$.ajax({
			type: "POST",
			url: "<?php echo __APP__;?>/works/user_action_rank",
			data: "score="+score+"&mid="+mid,
			dataType: "json",
			success: function(data){
				if(data.code=='ok'){
						$("#do_rank_"+mid).html(data.msg);
						$("#do_rank_class_"+mid).addClass("star-"+data.msg*10);
				}
				else if(data.code=='error'){
					alert(data.msg);
				}
			}
		});
	}
}
</script>
</body>
</html>